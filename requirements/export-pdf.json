{
  "feature": {
    "id": "EXPORT_PDF_001",
    "name": "Export AI Summary as Branded PDF",
    "goal": "Generate a visually appealing, modern PDF from the AI summary on-demand when user clicks Download",
    "scope": "backend_generation + frontend_trigger",
    "priority": "MVP",
    "cost_model": "free_only"
  },
  "user_story": {
    "as_a": "user",
    "i_want": "to download a clean, professional PDF of my AI summary",
    "so_that": "I can share meeting notes with clients, recruiters, or stakeholders"
  },
  "high_level_flow": {
    "trigger": "User clicks Download → PDF",
    "steps": [
      "Validate AI summary is READY",
      "Generate HTML summary if not already available",
      "Render HTML using branded PDF template",
      "Convert HTML to PDF on backend",
      "Stream progress to UI",
      "Return downloadable PDF file"
    ],
    "synchronous": true,
    "cancellable": true
  },
  "backend_pdf_generation": {
    "location": "backend_only",
    "recommended_tools": {
      "primary": {
        "name": "Playwright (Chromium)",
        "reason": "Best CSS support, modern layouts, free, consistent rendering"
      },
      "alternatives": [
        {
          "name": "Puppeteer",
          "reason": "Similar to Playwright, slightly heavier"
        },
        {
          "name": "wkhtmltopdf",
          "reason": "Fallback only, weaker CSS support"
        }
      ]
    },
    "constraints": [
      "Must support modern CSS (flex, grid)",
      "Must support custom fonts",
      "Must not rely on paid APIs",
      "Must sanitize HTML before rendering"
    ]
  },
  "input_sources": {
    "required": [
      "AISummary(kind=SUMMARY)",
      "AISummary(kind=KEY_POINTS)",
      "AISummary(kind=ACTION_ITEMS)"
    ],
    "optional": [
      "AISummary(kind=DECISIONS)",
      "Note.metadata",
      "MeetingSession.metadata"
    ]
  },
  "pdf_template": {
    "layout": "single_column_modern_report",
    "page": {
      "size": "A4",
      "margin_mm": {
        "top": 20,
        "right": 18,
        "bottom": 20,
        "left": 18
      },
      "background": "#ffffff"
    },
    "typography": {
      "font_family": "Inter",
      "fallbacks": ["Helvetica", "Arial", "sans-serif"],
      "base_font_size_px": 12,
      "heading_scale": {
        "h1": 24,
        "h2": 18,
        "h3": 14
      }
    },
    "color_palette": {
      "brand_primary": "#3B82F6",
      "brand_secondary": "#64748B",
      "text_primary": "#0F172A",
      "text_muted": "#475569",
      "border_light": "#E5E7EB",
      "background_section": "#F8FAFC"
    }
  },
  "branding": {
    "header": {
      "left": {
        "logo": {
          "source": "static_asset",
          "path": "/branding/logo.png",
          "height_px": 24
        }
      },
      "right": {
        "product_name": "AI Notes",
        "tagline": "Your personal AI meeting assistant"
      }
    },
    "footer": {
      "left": "Generated by AI Notes",
      "right": "{{generated_date}}",
      "page_numbers": true
    },
    "watermark": {
      "enabled": false,
      "text": "Confidential",
      "opacity": 0.05
    }
  },
  "pdf_sections": [
    {
      "id": "title",
      "type": "hero",
      "content": {
        "title": "{{note.title}}",
        "subtitle": "{{meeting_date_optional}}",
        "meta": [
          "Prepared for: {{recipient_optional}}",
          "Generated on: {{generated_date}}"
        ]
      }
    },
    {
      "id": "summary",
      "type": "section",
      "title": "Summary",
      "style": "highlighted_card",
      "content": "{{summary_bullets}}"
    },
    {
      "id": "key_points",
      "type": "section",
      "title": "Key Points",
      "content": "{{key_points_list}}"
    },
    {
      "id": "action_items",
      "type": "section",
      "title": "Action Items",
      "content": {
        "layout": "checklist",
        "items": "{{action_items}}"
      }
    },
    {
      "id": "decisions",
      "type": "section",
      "title": "Decisions",
      "optional": true,
      "content": "{{decisions_list}}"
    }
  ],
  "html_to_pdf_rules": {
    "html_source": "HTML_SUMMARY artifact",
    "preprocessing": [
      "Inject PDF-specific CSS",
      "Embed fonts locally",
      "Replace interactive elements with static equivalents",
      "Ensure color contrast WCAG AA"
    ],
    "sanitization": {
      "strip_scripts": true,
      "strip_iframes": true,
      "allow_tags": ["div", "p", "ul", "li", "h1", "h2", "h3", "strong", "em"]
    }
  },
  "progress_and_status": {
    "ui_messages": [
      "Preparing document",
      "Applying layout and branding",
      "Generating PDF",
      "Finalizing download"
    ],
    "backend_status_events": [
      "PDF_JOB_STARTED",
      "PDF_HTML_READY",
      "PDF_RENDERING",
      "PDF_READY",
      "PDF_FAILED"
    ]
  },
  "api_contract": {
    "endpoint": {
      "method": "POST",
      "path": "/api/export/pdf",
      "body": {
        "noteId": "uuid",
        "branding": "default",
        "locale": "en-GB"
      },
      "returns": {
        "artifactId": "uuid",
        "downloadUrl": "string"
      }
    },
    "sse_progress": {
      "endpoint": "/api/export/pdf/stream/:artifactId",
      "events": [
        {
          "type": "progress",
          "payload": {
            "pct": "int",
            "message": "string"
          }
        },
        {
          "type": "completed",
          "payload": {
            "downloadUrl": "string"
          }
        },
        {
          "type": "failed",
          "payload": {
            "error": "string"
          }
        }
      ]
    }
  },
  "file_naming": {
    "template": "{{note.title_slug}}-summary-{{yyyy_mm_dd}}.pdf",
    "sanitize": true,
    "max_length": 120
  },
  "security_and_privacy": {
    "access_control": [
      "Only note owner can generate PDF",
      "Shared users cannot generate unless explicitly allowed"
    ],
    "storage": {
      "location": "temporary_object_storage",
      "retention_days": 30,
      "auto_delete": true
    },
    "audit_log": {
      "event": "PDF_EXPORTED",
      "fields": ["userId", "noteId", "timestamp"]
    }
  },
  "tdd_test_suite": {
    "unit_tests": [
      {
        "id": "PDF_UT_001",
        "name": "HTML summary transformed into printable layout",
        "assert": ["all required sections present", "branding injected"]
      }
    ],
    "integration_tests": [
      {
        "id": "PDF_IT_001",
        "name": "PDF export end-to-end",
        "given": "AI summary READY",
        "then": [
          "POST /api/export/pdf returns artifactId",
          "PDF file generated",
          "Download URL accessible"
        ]
      }
    ],
    "visual_regression_tests": [
      {
        "id": "PDF_VRT_001",
        "name": "PDF layout consistency",
        "tool": "Playwright screenshot diff",
        "assert": ["header/footer stable", "fonts render correctly"]
      }
    ],
    "e2e_tests": [
      {
        "id": "PDF_E2E_001",
        "name": "User downloads PDF",
        "steps": [
          "Open note",
          "Click Download → PDF",
          "Observe progress messages",
          "File downloads successfully"
        ]
      }
    ]
  },
  "acceptance_criteria": [
    "PDF looks modern and professional",
    "Branding visible but not intrusive",
    "Content readable on A4 print",
    "Download only available when summary is READY",
    "No paid services required",
    "PDF generation completes under 5 seconds for normal notes"
  ]
}
